#!/bin/bash
# Source this to collect the correct daq libs for pydaq and pycdb
# This is not guaranteed to be conflict-free with your python env
# This works by expanding your LD_LIBRARY_PATH
if [ -z "${HUTCH}" ]; then
  # Default to daq latest
  DAQREL="/reg/g/pcds/dist/pds/current/build"
else
  DAQREL="/reg/g/pcds/dist/pds/${HUTCH}/current/build"
fi

OS_VER="$(uname -r | rev | cut -d . -f 2 | rev)"
if [ "${OS_VER}" = el5 ]; then
  OS_DIR=i386-linux
elif [ "${OS_VER}" = el6 ]; then
  OS_DIR=x86_64-linux
elif [ "${OS_VER}" = el7 ]; then
  OS_DIR=x86_64-rhel7
fi

if [ -z "${OS_DIR}" ]; then
  echo "Could not determine OS version"
else
  # Add daq libraries
  for dir in pdsapp pdsalg pds pdsdata offlinedb
  do
    export LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:${DAQREL}/${dir}/lib/${OS_DIR}"
  done
fi
